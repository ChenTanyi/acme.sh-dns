#!/bin/sh

# sed -i 's|FREENOM_SCRIPT="[A-Za-z0-9+/]*=\{0,2\}"|FREENOM_SCRIPT="'$(base64 -w 0 freenom.py)'"|g' dns_freenom.sh
FREENOM_SCRIPT="IyEvdXNyL2Jpbi9lbnYgcHl0aG9uMwppbXBvcnQgb3MKaW1wb3J0IHJlCmltcG9ydCBzeXMKaW1wb3J0IGJzNAppbXBvcnQganNvbgppbXBvcnQgbG9nZ2luZwppbXBvcnQgcmVxdWVzdHMKaW1wb3J0IHVybGxpYi5wYXJzZQoKdHJ5OgogICAgaW1wb3J0IGx4bWwKICAgIFBBUlNFUiA9ICdseG1sJwpleGNlcHQ6CiAgICBQQVJTRVIgPSAnaHRtbC5wYXJzZXInCgoKZGVmIHRyaW0oczogc3RyKSAtPiBzdHI6CiAgICByZXR1cm4gcmUuc3ViKHInXHMrJywgJyAnLCBzKS5zdHJpcCgpCgoKZGVmIGxvZ2dpbmdfdGFibGUodGl0bGVzLCByb3dzLCBsZW5ndGg6IGludCk6CiAgICBmb3JtYXRfZnVuYyA9IGxhbWJkYSB4OiBmJ3t4Ojx7bGVuZ3RoICsgMX1zfScKCiAgICBsb2dnaW5nLmluZm8oJyAnLmpvaW4obWFwKGZvcm1hdF9mdW5jLCB0aXRsZXMpKSkKICAgIGZvciByb3cgaW4gcm93czoKICAgICAgICBsb2dnaW5nLmluZm8oJyAnLmpvaW4obWFwKGZvcm1hdF9mdW5jLCByb3cpKSkKCgpkZWYgbG9naW4oc2VzczogcmVxdWVzdHMuU2Vzc2lvbik6CiAgICByID0gc2Vzcy5wb3N0KAogICAgICAgICdodHRwczovL215LmZyZWVub20uY29tL2RvbG9naW4ucGhwJywKICAgICAgICBoZWFkZXJzID0gewogICAgICAgICAgICAnUmVmZXJlcic6ICdodHRwczovL215LmZyZWVub20uY29tL2NsaWVudGFyZWEucGhwJywKICAgICAgICB9LAogICAgICAgIGRhdGEgPSB7CiAgICAgICAgICAgICd1c2VybmFtZSc6IG9zLmVudmlyb25bJ0ZSRUVOT01fVVNFUk5BTUUnXSwKICAgICAgICAgICAgJ3Bhc3N3b3JkJzogb3MuZW52aXJvblsnRlJFRU5PTV9QQVNTV09SRCddLAogICAgICAgIH0sCiAgICApCgogICAgaWYgNDAwIDw9IHIuc3RhdHVzX2NvZGUgPCA2MDA6CiAgICAgICAgbG9nZ2luZy5lcnJvcignTG9naW4gcmVxdWVzdCBmYWlsZWQnKQogICAgICAgIGxvZ2dpbmcuZXJyb3Ioci5jb250ZW50KQogICAgICAgIHIucmFpc2VfZm9yX3N0YXR1cygpCiAgICBlbHNlOgogICAgICAgIHF1ZXJ5ID0gdXJsbGliLnBhcnNlLnVybHBhcnNlKHIudXJsKS5xdWVyeQogICAgICAgIGlmIHVybGxpYi5wYXJzZS5wYXJzZV9xcyhxdWVyeSkuZ2V0KCdpbmNvcnJlY3QnKSA9PSAndHJ1ZSc6CiAgICAgICAgICAgIGxvZ2dpbmcuZXJyb3IoJ0xvZ2luIGZhaWxlZDogaW5jb3JyZWN0IGRldGFpbHMnKQogICAgICAgICAgICBzeXMuZXhpdCgxKQoKCmRlZiBsaXN0X2RvbWFpbnMoc2VzczogcmVxdWVzdHMuU2Vzc2lvbikgLT4gbGlzdDoKICAgICMgRG9tYWluIExpc3Q6IG5hbWUsIHJlZ2lzdHJhdGlvbiBkYXRlLCBleHBpcnkgZGF0ZSwgc3RhdHVzLCB0eXBlLCBtYW5hZ2UgdXJsCiAgICB1cmkgPSAnaHR0cHM6Ly9teS5mcmVlbm9tLmNvbS9jbGllbnRhcmVhLnBocD9hY3Rpb249ZG9tYWlucycKICAgIHIgPSBzZXNzLmdldCgKICAgICAgICB1cmksCiAgICAgICAgaGVhZGVycyA9IHsKICAgICAgICAgICAgJ1JlZmVyZXInOiAnaHR0cHM6Ly9teS5mcmVlbm9tLmNvbS9jbGllbnRhcmVhLnBocCcsCiAgICAgICAgfSwKICAgICkKICAgIHIucmFpc2VfZm9yX3N0YXR1cygpCgogICAgaHRtbCA9IGJzNC5CZWF1dGlmdWxTb3VwKHIuY29udGVudCwgUEFSU0VSKQogICAgZG9tYWluX2NvbnRlbnQgPSBodG1sKCdzZWN0aW9uJywgY2xhc3NfID0gJ2RvbWFpbkNvbnRlbnQnKQogICAgYXNzZXJ0IGxlbigKICAgICAgICBkb21haW5fY29udGVudAogICAgKSA9PSAxLCAnRG9tYWlucyBwYWdlIHNob3VsZCBvbmx5IGNvbnRhaW4gb25lIGRvbWFpbkNvbnRlbnQgc2VjdGlvbicKCiAgICBtYXhsZW4gPSAxMAogICAgdGl0bGVzID0gW10KICAgIHJvd3MgPSBbXQogICAgZm9yIHRyIGluIGRvbWFpbl9jb250ZW50WzBdKCd0cicpOgogICAgICAgIGlmIGxlbih0cigndGgnKSkgPiAwOgogICAgICAgICAgICBmb3IgdGggaW4gdHIoJ3RoJyk6CiAgICAgICAgICAgICAgICB0ZXh0ID0gdHJpbSh0aC50ZXh0KQogICAgICAgICAgICAgICAgaWYgdGV4dDoKICAgICAgICAgICAgICAgICAgICB0aXRsZXMuYXBwZW5kKHRleHQpCiAgICAgICAgZWxzZToKICAgICAgICAgICAgaXNfZG9tYWluID0gVHJ1ZQogICAgICAgICAgICByb3dzLmFwcGVuZChbXSkKICAgICAgICAgICAgZm9yIHRkIGluIHRyKCd0ZCcpOgogICAgICAgICAgICAgICAgdGV4dCA9IHRyaW0odGQudGV4dCkKICAgICAgICAgICAgICAgIGlmIHRleHQgPT0gJ01hbmFnZSBEb21haW4nOgogICAgICAgICAgICAgICAgICAgIGFzc2VydCBsZW4oCiAgICAgICAgICAgICAgICAgICAgICAgIHRkKCdhJykKICAgICAgICAgICAgICAgICAgICApID09IDEsICdNb3JlIHRoYW4gb25lIGxpbmsgZm91bmQgaW4gTWFuYWdlIERvbWFpbiBjb2x1bW4nCiAgICAgICAgICAgICAgICAgICAgcm93c1stMV0uYXBwZW5kKAogICAgICAgICAgICAgICAgICAgICAgICB1cmxsaWIucGFyc2UudXJsam9pbih1cmksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRkKCdhJylbMF1bJ2hyZWYnXSkpCiAgICAgICAgICAgICAgICBlbGlmIHRleHQ6CiAgICAgICAgICAgICAgICAgICAgcm93c1stMV0uYXBwZW5kKHRleHQpCiAgICAgICAgICAgICAgICAgICAgaWYgaXNfZG9tYWluOgogICAgICAgICAgICAgICAgICAgICAgICBtYXhsZW4gPSBtYXgobWF4bGVuLCBsZW4odGV4dCkpCiAgICAgICAgICAgICAgICAgICAgICAgIGlzX2RvbWFpbiA9IEZhbHNlCgogICAgbG9nZ2luZy5pbmZvKCdEb21haW4gTGlzdDonKQogICAgbG9nZ2luZ190YWJsZSh0aXRsZXMsIHJvd3MsIG1heGxlbikKICAgIHJldHVybiByb3dzCgoKZGVmIG1hbmFnZV9kb21haW4oCiAgICAgICAgdXJpOiBzdHIsCiAgICAgICAgZG9tYWluOiBzdHIsCiAgICAgICAgc2VzczogcmVxdWVzdHMuU2Vzc2lvbiwKICAgICAgICBhY3Rpb246IHN0ciwKICAgICAgICByZWNvcmRzOiBsaXN0ID0gTm9uZSwKKToKICAgIHF1ZXJ5ID0gdXJsbGliLnBhcnNlLnVybHBhcnNlKHVyaSkucXVlcnkKICAgIGRvbWFpbl9pZCA9IHVybGxpYi5wYXJzZS5wYXJzZV9xcyhxdWVyeSkuZ2V0KCdpZCcpCiAgICBpZiBub3QgZG9tYWluX2lkOgogICAgICAgIGxvZ2dpbmcuZXJyb3IoZidVbmFibGUgdG8gZ2V0IGRvbWFpbiBpZCBmcm9tIHt1cml9JykKICAgICAgICByZXR1cm4KCiAgICBkb21haW5faWQ6IHN0ciA9IGRvbWFpbl9pZFswXQogICAgbG9nZ2luZy5kZWJ1ZyhmJ2RvbWFpbiBpZCAie2RvbWFpbl9pZH0iJykKCiAgICBuZXh0X3VyaSA9IGYnaHR0cHM6Ly9teS5mcmVlbm9tLmNvbS9jbGllbnRhcmVhLnBocD9tYW5hZ2VkbnM9e2RvbWFpbn0mZG9tYWluaWQ9e2RvbWFpbl9pZH0nCgogICAgIyBzaW11bGF0ZSBicm93c2VyCiAgICAjIHIgPSBzZXNzLmdldCgKICAgICMgICAgIHVyaSwKICAgICMgICAgIGhlYWRlcnMgPSB7J1JlZmVyZXInOiAnaHR0cHM6Ly9teS5mcmVlbm9tLmNvbS9jbGllbnRhcmVhLnBocD9hY3Rpb249ZG9tYWlucyd9LAogICAgIyApCiAgICAjIHIgPSBzZXNzLmdldCgKICAgICMgICAgIG5leHRfdXJpLAogICAgIyAgICAgaGVhZGVycyA9IHsnUmVmZXJlcic6IHVyaX0sCiAgICAjICkKICAgIHVyaSA9IG5leHRfdXJpCgogICAgcGFyYW1zID0geydkbnNhY3Rpb24nOiBhY3Rpb259CiAgICBpZiBhY3Rpb24gPT0gJ2RlbGV0ZSc6CiAgICAgICAgcGFyYW1zWydtYW5hZ2VkbnMnXSA9IGRvbWFpbgogICAgICAgIHBhcmFtc1snZG9tYWluaWQnXSA9IGRvbWFpbl9pZAogICAgICAgIGZvciByZWNvcmQgaW4gcmVjb3JkczoKICAgICAgICAgICAgcGFyYW1zWyduYW1lJ10gPSByZWNvcmRbJ25hbWUnXQogICAgICAgICAgICBwYXJhbXNbJ3R0bCddID0gcmVjb3JkWyd0dGwnXQogICAgICAgICAgICBwYXJhbXNbJ3JlY29yZHMnXSA9IHJlY29yZFsndHlwZSddCiAgICAgICAgICAgIHBhcmFtc1sndmFsdWUnXSA9IHJlY29yZFsndmFsdWUnXQogICAgICAgICAgICByID0gc2Vzcy5nZXQoCiAgICAgICAgICAgICAgICBmJ2h0dHBzOi8vbXkuZnJlZW5vbS5jb20vY2xpZW50YXJlYS5waHAnLAogICAgICAgICAgICAgICAgcGFyYW1zID0gcGFyYW1zLAogICAgICAgICAgICAgICAgaGVhZGVycyA9IHsnUmVmZXJlcic6IHVyaX0sCiAgICAgICAgICAgICkKICAgICAgICAgICAgci5yYWlzZV9mb3Jfc3RhdHVzKCkKICAgIGVsaWYgYWN0aW9uID09ICdhZGQnOgogICAgICAgIGZvciBpIGluIHJhbmdlKGxlbihyZWNvcmRzKSk6CiAgICAgICAgICAgIHBhcmFtc1tmJ2FkZHJlY29yZFt7aX1dW25hbWVdJ10gPSByZWNvcmRzW2ldWyduYW1lJ10KICAgICAgICAgICAgcGFyYW1zW2YnYWRkcmVjb3JkW3tpfV1bdHlwZV0nXSA9IHJlY29yZHNbaV1bJ3R5cGUnXQogICAgICAgICAgICBwYXJhbXNbZidhZGRyZWNvcmRbe2l9XVt0dGxdJ10gPSByZWNvcmRzW2ldWyd0dGwnXQogICAgICAgICAgICBwYXJhbXNbZidhZGRyZWNvcmRbe2l9XVt2YWx1ZV0nXSA9IHJlY29yZHNbaV1bJ3ZhbHVlJ10KCiAgICAgICAgciA9IHNlc3MucG9zdCgKICAgICAgICAgICAgdXJpLAogICAgICAgICAgICBkYXRhID0gcGFyYW1zLAogICAgICAgICAgICBoZWFkZXJzID0geydSZWZlcmVyJzogdXJpfSwKICAgICAgICApCiAgICAgICAgci5yYWlzZV9mb3Jfc3RhdHVzKCkKICAgICMgZWxpZiBhY3Rpb24gPT0gJ21vZGlmeSc6ICMgbm90IG1vZGlmeSBjdXJyZW50bHkKICAgIGVsc2U6CiAgICAgICAgbG9nZ2luZy5lcnJvcihmJ1Vua25vd24gYWN0aW9uIHthY3Rpb259IGZvciBkb21haW4ge2RvbWFpbn0nKQogICAgICAgIHJldHVybgoKCmRlZiBtYWluKCk6CiAgICBpZiBsZW4oc3lzLmFyZ3YpIDwgNDoKICAgICAgICBsb2dnaW5nLmVycm9yKGYnVXNhZ2U6IHtzeXMuYXJndlswXX0gPGFjdGlvbj4gPGRvbWFpbj4gPHZhbHVlPicpCiAgICAgICAgc3lzLmV4aXQoMSkKCiAgICBhY3Rpb24sIGZ1bGxfZG9tYWluLCB2YWx1ZSA9IHN5cy5hcmd2WzE6NF0KICAgIHJlY29yZHMgPSBbCiAgICAgICAgewogICAgICAgICAgICAnbmFtZSc6IGZ1bGxfZG9tYWluLAogICAgICAgICAgICAndHRsJzogJzYwMCcsCiAgICAgICAgICAgICd0eXBlJzogJ1RYVCcsCiAgICAgICAgICAgICd2YWx1ZSc6IHZhbHVlLAogICAgICAgIH0sCiAgICBdCgogICAgd2l0aCByZXF1ZXN0cy5zZXNzaW9uKCkgYXMgc2VzczoKICAgICAgICBsb2dpbihzZXNzKQogICAgICAgIGRvbWFpbnMgPSBsaXN0X2RvbWFpbnMoc2VzcykKCiAgICAgICAgZm9yIGRvbWFpbiBpbiBkb21haW5zOgogICAgICAgICAgICBpZiBmdWxsX2RvbWFpbi5lbmRzd2l0aChkb21haW5bMF0pOgogICAgICAgICAgICAgICAgbWFuYWdlX2RvbWFpbihkb21haW5bLTFdLCBkb21haW5bMF0sIHNlc3MsIGFjdGlvbiwgcmVjb3JkcykKICAgICAgICAgICAgICAgIHJldHVybgoKCmlmIF9fbmFtZV9fID09ICJfX21haW5fXyI6CiAgICBsb2dnaW5nLmJhc2ljQ29uZmlnKAogICAgICAgIGxldmVsID0gbG9nZ2luZy5ERUJVRywKICAgICAgICBmb3JtYXQgPSAnJShhc2N0aW1lKXMgJShsZXZlbG5hbWUpcyAlKG1lc3NhZ2UpcycsCiAgICAgICAgZGF0ZWZtdCA9ICIlSDolTTolUyIpCiAgICBtYWluKCk="
FREENOM_SCRIPT=$(echo "$FREENOM_SCRIPT" | base64 -d)

# fulldomain txtvalue
dns_freenom_add() {
    python3 -c "$FREENOM_SCRIPT" add "$1" "$2"
}

# fulldomain txtvalue
dns_freenom_rm() {
    python3 -c "$FREENOM_SCRIP" delete "$1" "$2"
}
